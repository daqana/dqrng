<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast Pseudo Random Number Generators for R • dqrng</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fast Pseudo Random Number Generators for R">
<meta property="og:description" content="dqrng">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dqrng</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/dqrng.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cpp-api.html">C++ API</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel RNG usage</a>
    </li>
    <li>
      <a href="../articles/sample.html">Fast sampling methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/daqana/dqrng/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fast Pseudo Random Number Generators for R</h1>
                        <h4 data-toc-skip class="author">Ralf
Stubner</h4>
            
            <h4 data-toc-skip class="date">2024-05-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/daqana/dqrng/blob/HEAD/vignettes/dqrng.Rmd" class="external-link"><code>vignettes/dqrng.Rmd</code></a></small>
      <div class="hidden name"><code>dqrng.Rmd</code></div>

    </div>

    
    
<p>The dqrng package provides fast random number generators (RNG) with
good statistical properties for usage with R. It combines these RNGs
with fast distribution functions to sample from uniform, normal or
exponential distributions. Both the RNGs and the distribution functions
are distributed as C++ header-only library.</p>
<div class="section level2">
<h2 id="supported-random-number-generators">Supported Random Number Generators<a class="anchor" aria-label="anchor" href="#supported-random-number-generators"></a>
</h2>
<p>Support for the following 64bit RNGs are currently included:</p>
<ul>
<li>
<strong>pcg64</strong> The default 64 bit variant from the PCG
family developed by Melissa O’Neill. See <a href="https://www.pcg-random.org/" class="external-link uri">https://www.pcg-random.org/</a> for more details.</li>
<li>
<strong>Xoroshiro128++</strong> and
<strong>Xoshiro256++</strong><br>
RNGs developed by David Blackman and Sebastiano Vigna. See <a href="https://xoroshiro.di.unimi.it/" class="external-link uri">https://xoroshiro.di.unimi.it/</a> for more details. The
older generators Xoroshiro128+ and Xoshiro256+ should be used only for
backwards compatibility.</li>
<li>
<strong>Threefry</strong><br>
The 64 bit version of the 20 rounds Threefry engine (Salmon et al.,
2011) as provided by the package ‘sitmo’.</li>
</ul>
<p>Of these RNGs Xoroshiro128++ is used as default since it is fast,
small and has good statistical properties.</p>
</div>
<div class="section level2">
<h2 id="usage-from-r">Usage from R<a class="anchor" aria-label="anchor" href="#usage-from-r"></a>
</h2>
<p>Using these RNGs from R is deliberately similar to using R’s build-in
RNGs:</p>
<ul>
<li>
<code><a href="../reference/dqrng-functions.html">dqRNGkind()</a></code> is analogue to <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">RNGkind()</a></code> and
sets the RNG</li>
<li>
<code><a href="../reference/dqrng-functions.html">dqset.seed()</a></code> is analogue to <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> and
sets the seed</li>
<li>
<code><a href="../reference/dqrng-functions.html">dqrunif()</a></code>, <code><a href="../reference/dqrng-functions.html">dqrnorm()</a></code>, and
<code><a href="../reference/dqrng-functions.html">dqrexp()</a></code> are analogue to <code><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif()</a></code>,
<code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm()</a></code>, and <code><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp()</a></code> and sample from uniform,
normal or exponential distributions</li>
<li>
<code><a href="../reference/dqsample.html">dqsample()</a></code> and <code>dqsample.int</code> are analogue
to <code>sample</code> and <code>sample.int</code> for creating random
samples of vectors and vector indices</li>
</ul>
<p>Let’s look at the classical example of calculating <span class="math inline">\(\pi\)</span> via simulation. The basic idea is to
generate a large number of random points within the unit square. An
approximation for <span class="math inline">\(\pi\)</span> can then be
calculated from the ratio of points within the unit circle to the total
number of points. A vectorized implementation in R where we can switch
the RNG might look like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1e7</span></span>
<span><span class="va">piR</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">rng</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rng</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rng</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="fl">4</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"pi ~= "</span>, <span class="fu">piR</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; pi ~=  3.140899</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.361   0.041   0.401</span></span></code></pre></div>
<p>Using dqrng is about three times faster:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://daqana.github.io/dqrng/" class="external-link">dqrng</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dqrng-functions.html">dqset.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"pi ~= "</span>, <span class="fu">piR</span><span class="op">(</span><span class="va">N</span>, rng <span class="op">=</span> <span class="fu">dqrng</span><span class="fu">::</span><span class="va"><a href="../reference/dqrng-functions.html">dqrunif</a></span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; pi ~=  3.141457</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.172   0.036   0.207</span></span></code></pre></div>
<p>Since the calculations add a constant off-set, the speed-up for the
RNGs alone has to be even greater:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.076   0.012   0.088</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">dqrng</span><span class="fu">::</span><span class="fu"><a href="../reference/dqrng-functions.html">dqrunif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.024   0.007   0.031</span></span></code></pre></div>
<p>Similar for the exponential distribution:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.339   0.004   0.343</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">dqrng</span><span class="fu">::</span><span class="fu"><a href="../reference/dqrng-functions.html">dqrexp</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.043   0.003   0.046</span></span></code></pre></div>
<p>And for the normal distribution:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.361   0.004   0.365</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">dqrng</span><span class="fu">::</span><span class="fu"><a href="../reference/dqrng-functions.html">dqrnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.063   0.008   0.071</span></span></code></pre></div>
<p>As well as for sampling with and without replacement:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>   <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">N</span><span class="op">/</span><span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.554   0.032   0.586</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="fu"><a href="../reference/dqsample.html">dqsample.int</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">N</span><span class="op">/</span><span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.021   0.016   0.037</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>   <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">N</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.500   0.288   1.788</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="fu"><a href="../reference/dqsample.html">dqsample.int</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">N</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.054   0.008   0.061</span></span></code></pre></div>
<p>It is also possible to register the supplied generators as
user-supplied RNGs. This way <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> and
<code><a href="../reference/dqrng-functions.html">dqset.seed()</a></code> influence both <code>(dq)runif</code> and
<code>(dq)rnorm</code> in the same way. This is also true for other
<code>r&lt;dist&gt;</code> functions, but note that <code>rexp</code>
and <code>dqrexp</code> still give different results:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/user-supplied-rng.html">register_methods</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>;   <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3143534 0.7835753 0.1443660 0.1109871 0.6433407</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>;   <span class="fu">dqrng</span><span class="fu">::</span><span class="fu"><a href="../reference/dqrng-functions.html">dqrunif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3143534 0.7835753 0.1443660 0.1109871 0.6433407</span></span>
<span><span class="fu"><a href="../reference/dqrng-functions.html">dqset.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>; <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.3618122  0.8199887 -0.4075635  0.2073972 -0.8038326</span></span>
<span><span class="fu"><a href="../reference/dqrng-functions.html">dqset.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>; <span class="fu">dqrng</span><span class="fu">::</span><span class="fu"><a href="../reference/dqrng-functions.html">dqrnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.3618122  0.8199887 -0.4075635  0.2073972 -0.8038326</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>;   <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">rt</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.3196113 -0.4095873 -1.2928241  0.2399470 -0.1068945</span></span>
<span><span class="fu"><a href="../reference/dqrng-functions.html">dqset.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>; <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">rt</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.3196113 -0.4095873 -1.2928241  0.2399470 -0.1068945</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>;   <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0950560698 0.0567150561 0.1541222748 0.2512966671 0.0002175758</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4711</span><span class="op">)</span>;   <span class="fu">dqrng</span><span class="fu">::</span><span class="fu"><a href="../reference/dqrng-functions.html">dqrexp</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03254731 0.06855303 0.06977124 0.02579004 0.07629535</span></span>
<span><span class="fu"><a href="../reference/user-supplied-rng.html">restore_methods</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You can automatically register these methods when loading this
package by setting the option <code>dqrng.register_methods</code> to
<code>TRUE</code>, e.g. with
<code>options(dqrng.register_methods=TRUE)</code>.</p>
<p>For some workflows it is helpful to save and restore the RNG’s type
and state, similar to how <code>.Randome.seed</code> can be saved and
restored. The function pair <code><a href="../reference/dqrng-functions.html">dqrng_get_state()</a></code> and
<code><a href="../reference/dqrng-functions.html">dqrng_set_state()</a></code> can be used for this task:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dqrng-functions.html">dqrng_get_state</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "default"             "7442421893577288217" "2933090096537006399"</span></span>
<span><span class="fu"><a href="../reference/dqrng-functions.html">dqrunif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.850198175 0.184318214 0.003138956 0.071103977 0.430195275</span></span>
<span><span class="co"># many other operations, that could even change the used RNG type</span></span>
<span><span class="fu"><a href="../reference/dqrng-functions.html">dqrng_set_state</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dqrng-functions.html">dqrunif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.850198175 0.184318214 0.003138956 0.071103977 0.430195275</span></span></code></pre></div>
<p>Note that the state is represented by a character vector, since the
unsigned 64 and 128 bit integers used by the supported RNGs cannot be
represented in R otherwise. Generally this state should be treated as an
implementation detail and not manipulated directly.</p>
</div>
<div class="section level2">
<h2 id="usage-from-c">Usage from C++<a class="anchor" aria-label="anchor" href="#usage-from-c"></a>
</h2>
<p>The RNGs and distributions functions can also be used from C++ at
various levels of abstraction. Technically there are three ways to make
use of dqrng at the C++ level:</p>
<ul>
<li>use <code>// [[Rcpp::depends(dqrng)]]</code> together with
<code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">Rcpp::sourceCpp()</a></code>
</li>
<li>use <code>Rcpp::cppFunction(depends = "dqrng", ...)</code>
</li>
<li>use an R package with <code>LinkingTo: dqrng</code>
</li>
</ul>
<p>Here only the first approach is shown.</p>
<div class="section level3">
<h3 id="using-the-compiled-library-functions">Using the compiled library functions<a class="anchor" aria-label="anchor" href="#using-the-compiled-library-functions"></a>
</h3>
<p>The functions available in R directly call corresponding C++
functions. These functions are also available at the C++ level if you
include <code>dqrng.h</code>. The full list of functions is available
with <code><a href="../articles/cpp-api.html">vignette("cpp-api", package = "dqrng")</a></code>. Revisiting the
example of approximating <span class="math inline">\(\pi\)</span> we can
use:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng)]]</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng.h&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="kw">using</span> Rcpp<span class="op">::</span>IntegerVector<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="kw">using</span> Rcpp<span class="op">::</span>NumericVector<span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="kw">using</span> Rcpp<span class="op">::</span>sqrt<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="kw">using</span> Rcpp<span class="op">::</span>sum<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="kw">using</span> dqrng<span class="op">::</span>dqrunif<span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="dt">double</span> piCpp<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  dqrng<span class="op">::</span>dqset_seed<span class="op">(</span>IntegerVector<span class="op">::</span>create<span class="op">(</span><span class="dv">42</span><span class="op">));</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  NumericVector x <span class="op">=</span> dqrunif<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  NumericVector y <span class="op">=</span> dqrunif<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>  NumericVector d <span class="op">=</span> sqrt<span class="op">(</span>x<span class="op">*</span>x <span class="op">+</span> y<span class="op">*</span>y<span class="op">);</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  <span class="cf">return</span> <span class="fl">4.0</span> <span class="op">*</span> sum<span class="op">(</span>d <span class="op">&lt;</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">/</span> n<span class="op">;</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">system.time(cat("pi ~= ", piCpp(1e7), "\n"))</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>Note that in C++ you have to use <code>dqrng::dqset_seed()</code>,
whereas the analogue function in the R interface is called
<code><a href="../reference/dqrng-functions.html">dqrng::dqset.seed()</a></code>. For sampling with and without
replacement <code>dqrng::dqsample_int()</code> and
<code>dqrng::dqsample_num()</code> are the analogue of
<code><a href="../reference/dqsample.html">dqrng::dqsample.int()</a></code> in the R interface:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng)]]</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng.h&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="dt">void</span> sampleCpp<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  dqrng<span class="op">::</span>dqset_seed<span class="op">(</span>Rcpp<span class="op">::</span>IntegerVector<span class="op">::</span>create<span class="op">(</span><span class="dv">42</span><span class="op">));</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  Rcpp<span class="op">::</span>IntegerVector sample <span class="op">=</span> dqrng<span class="op">::</span>dqsample_int<span class="op">(</span>n<span class="op">,</span> n<span class="op">/</span><span class="dv">100</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  Rcpp<span class="op">::</span>Rcout <span class="op">&lt;&lt;</span> sample <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">sampleCpp(1000)</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-the-header-only-library">Using the header only library<a class="anchor" aria-label="anchor" href="#using-the-header-only-library"></a>
</h3>
<p>The RNG wrapper and distributions functions can be used from C++ by
including <code>dqrng_generator.h</code> and
<code>dqrng_distribution.h</code>. In order to use these header files,
you have to use at least C++11. You have to link to the <code>BH</code>
package as well to use dqrng’s distribution functions. For example, you
can use the distribution functions from dqrng together with some foreign
64bit RNG. Here a minimal <a href="https://xoroshiro.di.unimi.it/splitmix64.c" class="external-link">SplitMix</a> generator
is used together with <code>dqrng::normal_distribution</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng, BH)]]</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng_distribution.h&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="kw">class</span> SplitMix <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="kw">typedef</span> <span class="dt">uint64_t</span> <span class="dt">result_type</span><span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  SplitMix <span class="op">(</span><span class="dt">result_type</span> seed<span class="op">)</span> <span class="op">:</span> state<span class="op">(</span>seed<span class="op">)</span> <span class="op">{};</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="dt">result_type</span> <span class="kw">operator</span><span class="op">()</span> <span class="op">()</span> <span class="op">{</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    <span class="dt">result_type</span> z <span class="op">=</span> <span class="op">(</span>state <span class="op">+=</span> <span class="bn">0x9e3779b97f4a7c15</span><span class="bu">ULL</span><span class="op">);</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    z <span class="op">=</span> <span class="op">(</span>z <span class="op">^</span> <span class="op">(</span>z <span class="op">&gt;&gt;</span> <span class="dv">30</span><span class="op">))</span> <span class="op">*</span> <span class="bn">0xbf58476d1ce4e5b9</span><span class="bu">ULL</span><span class="op">;</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    z <span class="op">=</span> <span class="op">(</span>z <span class="op">^</span> <span class="op">(</span>z <span class="op">&gt;&gt;</span> <span class="dv">27</span><span class="op">))</span> <span class="op">*</span> <span class="bn">0x94d049bb133111eb</span><span class="bu">ULL</span><span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    <span class="cf">return</span> z <span class="op">^</span> <span class="op">(</span>z <span class="op">&gt;&gt;</span> <span class="dv">31</span><span class="op">);</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>  <span class="dt">void</span> seed<span class="op">(</span><span class="dt">result_type</span> seed<span class="op">)</span> <span class="op">{</span>state <span class="op">=</span> seed<span class="op">;}</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>  <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">result_type</span> min<span class="op">()</span> <span class="op">{</span><span class="cf">return</span> <span class="dv">0</span><span class="op">;};</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>  <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">result_type</span> max<span class="op">()</span> <span class="op">{</span><span class="cf">return</span> UINT64_MAX<span class="op">;};</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>  <span class="dt">result_type</span> state<span class="op">;</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span>  </span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  <span class="kw">friend</span> <span class="bu">std::</span>ostream<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="bu">std::</span>ostream<span class="op">&amp;</span> ost<span class="op">,</span> <span class="at">const</span> SplitMix<span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>    <span class="cf">return</span> ost <span class="op">&lt;&lt;</span> e<span class="op">.</span>state<span class="op">;</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>  <span class="kw">friend</span> <span class="bu">std::</span>istream<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="bu">std::</span>istream<span class="op">&amp;</span> ist<span class="op">,</span> SplitMix<span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>    <span class="cf">return</span> ist <span class="op">&gt;&gt;</span> e<span class="op">.</span>state<span class="op">;</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericVector splitmix_rnorm<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> n<span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> mean <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> sd <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>  <span class="kw">auto</span> rng <span class="op">=</span> dqrng<span class="op">::</span>generator<span class="op">&lt;</span>SplitMix<span class="op">&gt;(</span><span class="dv">42</span><span class="op">);</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>  Rcpp<span class="op">::</span>NumericVector result<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>  rng<span class="op">-&gt;</span>generate<span class="op">&lt;</span>dqrng<span class="op">::</span>normal_distribution<span class="op">&gt;(</span>result<span class="op">,</span> mean<span class="op">,</span> sd<span class="op">);</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a><span class="co">splitmix_rnorm(10)</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a><span class="co">system.time(splitmix_rnorm(1e7))</span></span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>Since SplitMix is a very fast RNG, the speed of this function is
comparable to <code>dqrnorm</code>. Generally speaking you can use any
C++11 compliant RNG with 64 bit output size. For example, here the 64
bit Threefry engine with 13 rounds from package sitmo is used:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng, BH, sitmo)]]</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng_distribution.h&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;threefry.h&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericVector threefry_rnorm<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> n<span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> mean <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> sd <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="kw">auto</span> rng <span class="op">=</span> dqrng<span class="op">::</span>generator<span class="op">&lt;</span>sitmo<span class="op">::</span>threefry_13_64<span class="op">&gt;(</span><span class="dv">42</span><span class="op">);</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  Rcpp<span class="op">::</span>NumericVector result<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  rng<span class="op">-&gt;</span>generate<span class="op">&lt;</span>dqrng<span class="op">::</span>normal_distribution<span class="op">&gt;(</span>result<span class="op">,</span> mean<span class="op">,</span> sd<span class="op">);</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">threefry_rnorm(10)</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">system.time(threefry_rnorm(1e7))</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>Note that for the (recommended) Threefry engine with 20 rounds some
additional integration is provided in the <code>dqrng_threefry.h</code>
header file.</p>
<p>Alternatively, you could combine the included RNGs together with
dqrng’s tooling and some other distribution function. For example, this
function generates random numbers according to the normal distribution
using the standard library from C++11:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;random&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng)]]</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng_generator.h&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;xoshiro.h&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericVector std_rnorm<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> n<span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> mean <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> sd <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  <span class="kw">auto</span> rng <span class="op">=</span> dqrng<span class="op">::</span>generator<span class="op">&lt;</span>dqrng<span class="op">::</span>xoroshiro128plusplus<span class="op">&gt;(</span><span class="dv">42</span><span class="op">);</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  Rcpp<span class="op">::</span>NumericVector result<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  rng<span class="op">-&gt;</span>generate<span class="op">&lt;</span><span class="bu">std::</span>normal_distribution<span class="op">&gt;(</span>result<span class="op">,</span> mean<span class="op">,</span> sd<span class="op">);</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">std_rnorm(10)</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">system.time(std_rnorm(1e7))</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>Typically this is not as fast as <code>dqrnorm</code>, but the
technique is useful to support distributions not (yet) included in
dqrng. Note however, that the algorithms used for the distributions from
C++11 are <em>implementation defined</em>.</p>
<p>Finally you could directly use the base generators, which are
provided as header-only libraries, without dqrng’s tooling. For example,
the following function uses the 32 bit PCG variant together with Boost’s
normal distribution function:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng, BH)]]</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pcg_random.hpp&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/random/normal_distribution.hpp&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">// [[Rcpp::plugins(cpp11)]]   </span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericVector boost_pcg_rnorm<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> n<span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> mean <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> <span class="at">const</span> <span class="dt">double</span> sd <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  pcg32 rng<span class="op">(</span><span class="dv">42</span><span class="op">);</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  <span class="ex">boost::</span>random::normal_distribution<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> dist<span class="op">(</span>mean<span class="op">,</span> sd<span class="op">);</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  Rcpp<span class="op">::</span>NumericVector result<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="bu">std::</span>generate<span class="op">(</span>result<span class="op">.</span>begin<span class="op">(),</span> result<span class="op">.</span>end<span class="op">(),</span> <span class="op">[&amp;</span>dist<span class="op">,</span> <span class="op">&amp;</span>rng<span class="op">](){</span><span class="cf">return</span> dist<span class="op">(</span>rng<span class="op">);});</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">boost_pcg_rnorm(10)</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">system.time(boost_pcg_rnorm(1e7))</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>This is quite fast since
<code>boost::random::normal_distribution</code> uses the fast Ziggurat
algorithm. For some applications it is necessary to draw random numbers
from multiple distributions with varying parameters. The following
function uses a binomial distribution (from <code>boost.random</code>)
as well as the normal distribution from <code>dqrng</code>. The
parameters of the distributions are adjusted for every draw using
<code>&lt;distribution&gt;::param_type</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng, BH)]]</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/random/binomial_distribution.hpp&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng_distribution.h&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericMatrix multiple_distributions<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="kw">auto</span> rng <span class="op">=</span> dqrng<span class="op">::</span>generator<span class="op">&lt;</span>dqrng<span class="op">::</span>xoshiro256plusplus<span class="op">&gt;(</span><span class="dv">42</span><span class="op">);</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  Rcpp<span class="op">::</span>NumericMatrix out<span class="op">(</span>n<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="dt">double</span> p <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>    p <span class="op">=</span> <span class="dt">double</span><span class="op">(</span>i<span class="op">)</span> <span class="op">/</span> <span class="dt">double</span><span class="op">(</span>n<span class="op">);</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    out<span class="op">(</span>i<span class="op">,</span><span class="dv">0</span><span class="op">)</span> <span class="op">=</span> rng<span class="op">-&gt;</span>variate<span class="op">&lt;</span><span class="ex">boost::</span>random::binomial_distribution<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;(</span><span class="dv">1</span><span class="op">,</span> p<span class="op">);</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>    out<span class="op">(</span>i<span class="op">,</span><span class="dv">1</span><span class="op">)</span> <span class="op">=</span> rng<span class="op">-&gt;</span>variate<span class="op">&lt;</span>dqrng<span class="op">::</span>normal_distribution<span class="op">&gt;(</span>p<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>    out<span class="op">(</span>i<span class="op">,</span><span class="dv">2</span><span class="op">)</span> <span class="op">=</span> rng<span class="op">-&gt;</span>variate<span class="op">&lt;</span>dqrng<span class="op">::</span>normal_distribution<span class="op">&gt;(</span><span class="fl">4.0</span><span class="op">,</span> <span class="fl">3.0</span> <span class="op">-</span> p<span class="op">);</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>  Rcpp<span class="op">::</span>colnames<span class="op">(</span>out<span class="op">)</span> <span class="op">=</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">::</span>create<span class="op">(</span><span class="st">"Bernoulli"</span><span class="op">,</span> <span class="st">"Normal1"</span><span class="op">,</span> <span class="st">"Normal2"</span><span class="op">);</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="co">multiple_distributions(5)</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="accessing-the-global-rng">Accessing the global RNG<a class="anchor" aria-label="anchor" href="#accessing-the-global-rng"></a>
</h2>
<p>You may use the class <code>dqrng::random_64bit_accessor</code> to
use the <strong>seeded</strong> RNG engine of <code>dqrng</code>. Please
note that the included RNG will be invalidated if <code>dqRNGkind</code>
is called. You therefore should use this calls only within
functions:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">// [[Rcpp::depends(dqrng, BH)]]</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;boost/random/binomial_distribution.hpp&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng.h&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;dqrng_distribution.h&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericMatrix multiple_distributions<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  <span class="kw">auto</span> rng <span class="op">=</span> dqrng<span class="op">::</span>random_64bit_accessor<span class="op">{};</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>  Rcpp<span class="op">::</span>NumericMatrix out<span class="op">(</span>n<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>  <span class="dt">double</span> p <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    p <span class="op">=</span> <span class="dt">double</span><span class="op">(</span>i<span class="op">)</span> <span class="op">/</span> <span class="dt">double</span><span class="op">(</span>n<span class="op">);</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    out<span class="op">(</span>i<span class="op">,</span><span class="dv">0</span><span class="op">)</span> <span class="op">=</span> rng<span class="op">.</span>variate<span class="op">&lt;</span><span class="ex">boost::</span>random::binomial_distribution<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;(</span><span class="dv">1</span><span class="op">,</span> p<span class="op">);</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>    out<span class="op">(</span>i<span class="op">,</span><span class="dv">1</span><span class="op">)</span> <span class="op">=</span> rng<span class="op">.</span>variate<span class="op">&lt;</span>dqrng<span class="op">::</span>normal_distribution<span class="op">&gt;(</span>p<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>    out<span class="op">(</span>i<span class="op">,</span><span class="dv">2</span><span class="op">)</span> <span class="op">=</span> rng<span class="op">.</span>variate<span class="op">&lt;</span>dqrng<span class="op">::</span>normal_distribution<span class="op">&gt;(</span><span class="fl">4.0</span><span class="op">,</span> <span class="fl">3.0</span> <span class="op">-</span> p<span class="op">);</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>  Rcpp<span class="op">::</span>colnames<span class="op">(</span>out<span class="op">)</span> <span class="op">=</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">::</span>create<span class="op">(</span><span class="st">"Bernoulli"</span><span class="op">,</span> <span class="st">"Normal1"</span><span class="op">,</span> <span class="st">"Normal2"</span><span class="op">);</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co">dqRNGkind("Xoshiro256++")</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="co">dqset.seed(42)</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="co">multiple_distributions(5)</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ralf Stubner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
